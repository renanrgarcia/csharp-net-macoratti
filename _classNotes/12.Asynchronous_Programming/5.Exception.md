# Async Exception Handling

- In asynchronous programming, exceptions can occur in tasks that run concurrently. Handling these exceptions properly is crucial to ensure the stability of the application.
- In C#, when using `async` and `await`, exceptions thrown in an asynchronous method are captured and re-thrown when the task is awaited.
- An asynchronous method that throws an exception will result in a `Task` that is in a faulted state.
  - `Task.IsFaulted` property can be checked to determine if the task has encountered an exception.
  - Throwned exceptions are encapsulated in an `AggregateException` when using `Task.WhenAll` or similar methods. `AggregateException.InnerExceptions` property can be used to access the individual exceptions.
- In the case of `async void` methods, exceptions are not propagated to the caller and will crash the application if not handled within the method itself. It is recommended to avoid `async void` except for event handlers.

## Try-Catch in Async Methods

- You must use try-catch blocks within asynchronous methods to handle exceptions that may occur during the execution of awaited tasks.

```csharp
static async Task MyAsyncMethod()
{
    try
    {
        await SomeAsyncMethod();
    }
    catch (Exception ex)
    {
        // Handle exception
    }
}
```

## Handling Multiple Exceptions

- If we use just `await` and `try-catch` on multiple tasks, the first exception encountered will be thrown, and the rest will be ignored.
- To handle multiple exceptions, we can use `Task.WhenAll` and catch the `AggregateException`.

```csharp
await ThrowMultipleExceptionsAsync();

async Task ThrowMultipleExceptionsAsync()
{
    try
    {
        var task1 = Task.Run(() => throw new InvalidOperationException("Invalid operation"));
        var task2 = Task.Run(() => throw new ArgumentNullException("Argument null"));
        await Task.WhenAll(task1, task2);
    }
    catch (AggregateException aggEx)
    {
        foreach (var ex in aggEx.InnerExceptions)
        {
            Console.WriteLine($"Caught exception: {ex.Message}");
        }
    }
    // Error handling individually. This way, only the first exception is caught.
    // catch (InvalidOperationException ex)
    // {
    //     Console.WriteLine($"Caught exception: {ex.Message}");
    // }
    // catch (ArgumentNullException ex)
    // {
    //     Console.WriteLine($"Caught exception: {ex.Message}");
    // }
}
```
